<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Perspective Block Text</title>

<style>
body {
    background: #eee;
    font-family: sans-serif;
    padding: 20px;
}

.controls {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 20px;
}

svg {
    border: 1px solid #ccc;
    background: white;
    transform-origin: center center;
}

</style>
</head>
<body>

<h2>Perspective Text Generator</h2>

<div class="controls">
    <input id="textInput" type="text" value="BLOCK">
    <label>Z Rotate
        <input id="rotateZ" type="range" min="0" max="360" value="0">
    </label>
    <label>Upload TTF
        <input id="fontUpload" type="file" accept=".ttf">
    </label>
</div>

<svg id="svg" width="800" height="300">
    <defs></defs>

    <!-- perspective lines -->
    <g id="lines" stroke="#000" stroke-width="1" fill="none"></g>

    <!-- text -->
    <text id="text"
          x="200"
          y="180"
          font-size="120"
          font-weight="900"
          fill="none"
          stroke="black"
          stroke-width="2">
        BLOCK
    </text>
</svg>

<script>
const svg = document.getElementById("svg");
const textEl = document.getElementById("text");
const linesGroup = document.getElementById("lines");
const input = document.getElementById("textInput");
const rotateZ = document.getElementById("rotateZ");
const fontUpload = document.getElementById("fontUpload");

// fixed vanishing point
const VANISH_X = 400;
const VANISH_Y = 20;

function redrawPerspective() {
    linesGroup.innerHTML = "";

    const box = textEl.getBBox();

    const points = [
        [box.x, box.y],
        [box.x + box.width, box.y],
        [box.x, box.y + box.height],
        [box.x + box.width, box.y + box.height],
        [box.x + box.width / 2, box.y],
        [box.x + box.width / 2, box.y + box.height]
    ];

    points.forEach(p => {
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", p[0]);
        line.setAttribute("y1", p[1]);
        line.setAttribute("x2", VANISH_X);
        line.setAttribute("y2", VANISH_Y);
        linesGroup.appendChild(line);
    });
}

// text update
input.addEventListener("input", () => {
    textEl.textContent = input.value;
    redrawPerspective();
});

// Z rotation only
rotateZ.addEventListener("input", () => {
    svg.style.transform = `rotate(${rotateZ.value}deg)`;
});

// font upload
fontUpload.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const fontURL = URL.createObjectURL(file);
    const fontName = "customFont";

    const style = document.createElement("style");
    style.innerHTML = `
        @font-face {
            font-family: '${fontName}';
            src: url('${fontURL}');
        }
        #text {
            font-family: '${fontName}';
        }
    `;
    document.head.appendChild(style);

    redrawPerspective();
});

redrawPerspective();
</script>

</body>
</html>
